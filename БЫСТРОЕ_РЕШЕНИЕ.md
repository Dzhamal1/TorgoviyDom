# –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï –æ—à–∏–±–∫–∏ "Database error saving new user"

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
```
–ö–æ–¥ –æ—à–∏–±–∫–∏: 500
–°–æ–æ–±—â–µ–Ω–∏–µ: Database error saving new user
```

## ‚ö° –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï (5 –º–∏–Ω—É—Ç)

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [supabase.com](https://supabase.com)
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor**

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –∫–æ–¥ (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ):

```sql
-- –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É profiles
CREATE TABLE IF NOT EXISTS public.profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  email TEXT NOT NULL,
  full_name TEXT,
  phone TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º RLS
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Users can view own profile" ON public.profiles;
DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;
DROP POLICY IF EXISTS "System can insert profiles" ON public.profiles;

-- –°–æ–∑–¥–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY "Users can view own profile" ON public.profiles
  FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON public.profiles
  FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Users can insert own profile" ON public.profiles
  FOR INSERT WITH CHECK (auth.uid() = id);

CREATE POLICY "System can insert profiles" ON public.profiles
  FOR INSERT WITH CHECK (true);

-- –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä
DROP TRIGGER IF EXISTS on_auth_user_created ON auth.users;
DROP FUNCTION IF EXISTS public.handle_new_user();

CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger 
LANGUAGE plpgsql 
SECURITY DEFINER
AS $$
DECLARE
  user_full_name TEXT;
  user_phone TEXT;
BEGIN
  user_full_name := COALESCE(NEW.raw_user_meta_data->>'full_name', split_part(NEW.email, '@', 1));
  user_phone := NEW.raw_user_meta_data->>'phone';
  
  INSERT INTO public.profiles (id, email, full_name, phone)
  VALUES (
    NEW.id,
    NEW.email,
    user_full_name,
    user_phone
  );
  
  RETURN NEW;
EXCEPTION
  WHEN unique_violation THEN
    RETURN NEW;
  WHEN OTHERS THEN
    RAISE WARNING '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è %: %', NEW.email, SQLERRM;
    RETURN NEW;
END;
$$;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

### 3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"RUN"** –≤ SQL Editor

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Authentication

–í Supabase Dashboard ‚Üí **Authentication** ‚Üí **Settings**:

- ‚úÖ **Enable signup** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–æ
- ‚ùå **Confirm email** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –û–¢–ö–õ–Æ–ß–ï–ù–û (–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω SMTP)
- üåê **Site URL**: `http://localhost:5173`
- üîÑ **Redirect URLs**: `http://localhost:5173/**`

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run dev
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
   ```
   ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
   ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω: –ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ```

## üîç –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ª–æ–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (–ø–æ—è–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
3. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ SQL –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∏–ª–∞—Å—å, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ `.env`
- –ß—Ç–æ –≤—Å–µ SQL –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –±–µ–∑ –æ—à–∏–±–æ–∫
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Authentication –≤ Supabase Dashboard

**–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è: 5 –º–∏–Ω—É—Ç** ‚è±Ô∏è