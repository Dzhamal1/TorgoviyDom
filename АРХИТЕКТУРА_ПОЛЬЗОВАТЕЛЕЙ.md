# ะััะธัะตะบัััะฐ ัะธััะตะผั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

## ๐ฏ ะัะฑัะฐะฝะฝะพะต ัะตัะตะฝะธะต: ะะะขะะะะะฌะะะฏ ะะะฅะะขะะะขะฃะะ

ะะพัะปะต ะฐะฝะฐะปะธะทะฐ ะฒะฐัะตะณะพ ะบะพะดะฐ, ั ะพะฟัะตะดะตะปะธะป, ััะพ ั ะฒะฐั **ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะพะฟัะธะผะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ** ะดะปั ัะฐะฑะพัั ั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ. ะะพั ะฟะพัะตะผั ััะพ ะปัััะธะน ะฟะพะดัะพะด:

## ๐๏ธ ะขะตะบััะฐั ะฐััะธัะตะบัััะฐ

### 1. ะขะฐะฑะปะธัะฐ `auth.users` (ะกะธััะตะผะฝะฐั)
- **ะะฐะทะฝะฐัะตะฝะธะต:** ะฃะฟัะฐะฒะปัะตััั Supabase ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ
- **ะกะพะดะตัะถะธั:** email, password_hash, ัะพะบะตะฝั, ะผะตัะฐะดะฐะฝะฝัะต
- **ะัะตะธะผััะตััะฒะฐ:** ะะฒัะพะผะฐัะธัะตัะบะฐั ะฑะตะทะพะฟะฐัะฝะพััั, JWT ัะพะบะตะฝั, ัะตััะธะธ

### 2. ะขะฐะฑะปะธัะฐ `profiles` (ะะพะปัะทะพะฒะฐัะตะปััะบะฐั)
- **ะะฐะทะฝะฐัะตะฝะธะต:** ะฅัะฐะฝะตะฝะธะต ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปั
- **ะกะพะดะตัะถะธั:** full_name, phone, created_at, updated_at
- **ะกะฒัะทั:** profiles.id โ auth.users.id (UUID)

### 3. ะขัะธะณะณะตั `handle_new_user()`
```sql
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, email, full_name, phone)
  VALUES (
    new.id,
    new.email,
    new.raw_user_meta_data->>'full_name',
    new.raw_user_meta_data->>'phone'
  );
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

## โ ะัะตะธะผััะตััะฒะฐ ัะตะบััะตะน ะฐััะธัะตะบัััั

### 1. **ะะฒัะพะผะฐัะธะทะฐัะธั**
- ะัะพัะธะปั ัะพะทะดะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ัะตะณะธัััะฐัะธะธ
- ะะตั ะฝะตะพะฑัะพะดะธะผะพััะธ ะฒ ะดะพะฟะพะปะฝะธัะตะปัะฝัั API ะฒัะทะพะฒะฐั
- ะะฐัะฐะฝัะธัะพะฒะฐะฝะฝะฐั ะบะพะฝัะธััะตะฝัะฝะพััั ะดะฐะฝะฝัั

### 2. **ะะตะทะพะฟะฐัะฝะพััั**
- RLS ะฟะพะปะธัะธะบะธ ะทะฐัะธัะฐัั ะดะฐะฝะฝัะต
- ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ัะพะปัะบะพ ัะฒะพะน ะฟัะพัะธะปั
- ะะฒัะพะผะฐัะธัะตัะบะฐั ัะฒัะทั ัะตัะตะท auth.uid()

### 3. **ะะฐัััะฐะฑะธััะตะผะพััั**
- ะะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ะฟะพะปั ะฒ profiles
- ะกะธััะตะผะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ ะพััะฐะตััั ะฝะตะธะทะผะตะฝะฝะพะน
- ะะพะดะดะตัะถะบะฐ ัะฐะทะปะธัะฝัั ะฟัะพะฒะฐะนะดะตัะพะฒ (Google, GitHub ะธ ั.ะด.)

### 4. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**
- ะะธะฝะธะผัะผ ะทะฐะฟัะพัะพะฒ ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
- ะญััะตะบัะธะฒะฝัะต ะธะฝะดะตะบัั ะฝะฐ UUID
- ะััะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปะตะน ะฒ ะบะพะฝัะตะบััะต

## ๐ง ะัะฟะพะปะฝะตะฝะฝัะต ะพะฟัะธะผะธะทะฐัะธะธ

### 1. ะฃะปัััะตะฝะฐ ะทะฐะณััะทะบะฐ ะฟัะพัะธะปะตะน
```typescript
// ะะพะฑะฐะฒะปะตะฝะพ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต ะฟัะพัะธะปั ะตัะปะธ ััะธะณะณะตั ะฝะต ััะฐะฑะพัะฐะป
const createProfileIfNotExists = async (user: User) => {
  // ะะตะทะตัะฒะฝะพะต ัะพะทะดะฐะฝะธะต ะฟัะพัะธะปั
}
```

### 2. ะฃะปัััะตะฝะฐ ัะตะณะธัััะฐัะธั
```typescript
// ะะฒัะพะผะฐัะธัะตัะบะฐั ะทะฐะณััะทะบะฐ ะฟัะพัะธะปั ะฟะพัะปะต ัะตะณะธัััะฐัะธะธ
if (data.user && data.session) {
  setTimeout(() => {
    loadProfile(data.user!.id)
  }, 1500)
}
```

### 3. ะะพะฑะฐะฒะปะตะฝะฐ ะพัะบะฐะทะพัััะพะนัะธะฒะพััั
- Retry ะปะพะณะธะบะฐ ะดะปั ัะตัะตะฒัั ะพัะธะฑะพะบ
- Fallback ัะพะทะดะฐะฝะธะต ะฟัะพัะธะปั
- ะะตัะฐะปัะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะฐ

## ๐ซ ะะพัะตะผั ะะ ะฝัะถะฝะฐ ะพัะดะตะปัะฝะฐั ัะฐะฑะปะธัะฐ "ะฐะบะบะฐัะฝัะพะฒ"

### ะะปััะตัะฝะฐัะธะฒะฝัะน ะฟะพะดัะพะด (ะะ ัะตะบะพะผะตะฝะดัะตััั):
```sql
-- ะะปะพัะพะน ะฟะพะดัะพะด - ะดัะฑะปะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั
CREATE TABLE accounts (
  id UUID PRIMARY KEY,
  email TEXT,
  password_hash TEXT, -- ะัะฑะปะธัะพะฒะฐะฝะธะต auth.users
  full_name TEXT,
  phone TEXT
);
```

### ะัะพะฑะปะตะผั ััะพะณะพ ะฟะพะดัะพะดะฐ:
1. **ะัะฑะปะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั** - email ะธ ะฟะฐัะพะปะธ ัะถะต ะฒ auth.users
2. **ะกะปะพะถะฝะพััั ัะธะฝััะพะฝะธะทะฐัะธะธ** - ะฝัะถะฝะพ ะฟะพะดะดะตัะถะธะฒะฐัั ะดะฒะฐ ะผะตััะฐ
3. **ะะตะทะพะฟะฐัะฝะพััั** - ัะฐะผะพััะพััะตะปัะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะฟะฐัะพะปัะผะธ
4. **ะะพัะตัั ััะฝะบัะธะน** - ะฝะตั JWT, OAuth, ัะฑัะพัะฐ ะฟะฐัะพะปะตะน
5. **ะะพะปััะต ะบะพะดะฐ** - ะดะพะฟะพะปะฝะธัะตะปัะฝะฐั ะปะพะณะธะบะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ

## ๐ ะกัะตะผะฐ ัะตะบััะตะน ะฐััะธัะตะบัััั

```
โโโโโโโโโโโโโโโโโโโ    ะขัะธะณะณะตั     โโโโโโโโโโโโโโโโโโโ
โ   auth.users    โ โโโโโโโโโโโโโบ โ    profiles     โ
โโโโโโโโโโโโโโโโโโโค                โโโโโโโโโโโโโโโโโโโค
โ id (UUID)       โโโโโโโโโโโโโโโโโค id (UUID)       โ
โ email           โ                โ email           โ
โ password_hash   โ                โ full_name       โ
โ user_metadata   โ                โ phone           โ
โ created_at      โ                โ created_at      โ
โโโโโโโโโโโโโโโโโโโ                โโโโโโโโโโโโโโโโโโโ
        โ                                   โ
        โโโโโโโโโโ RLS Policies โโโโโโโโโโโโโ
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต ะฐััะธัะตะบัััั

ะะพัะปะต ะฝะฐัััะพะนะบะธ .env ะธ ัะพะทะดะฐะฝะธั ัะฐะฑะปะธั, ะฟัะพัะตััะธััะนัะต:

### 1. ะะตะณะธัััะฐัะธั ะฝะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
```javascript
// ะ ะบะพะฝัะพะปะธ ะฑัะฐัะทะตัะฐ ะดะพะปะถะฝั ะฟะพัะฒะธัััั ะปะพะณะธ:
// ๐ ะะฐัะธะฝะฐะตะผ ัะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
// โ ะะตะณะธัััะฐัะธั ััะฟะตัะฝะฐ!
// ๐ ะะพะปัะทะพะฒะฐัะตะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะฒัะพัะธะทะพะฒะฐะฝ, ะทะฐะณััะถะฐะตะผ ะฟัะพัะธะปั...
// โ ะัะพัะธะปั ะทะฐะณััะถะตะฝ: ะะผั ะะพะปัะทะพะฒะฐัะตะปั
```

### 2. ะัะพะฒะตัะบะฐ ะฒ ะฑะฐะทะต ะดะฐะฝะฝัั
```sql
-- ะ Supabase SQL Editor:
SELECT * FROM auth.users ORDER BY created_at DESC LIMIT 1;
SELECT * FROM profiles ORDER BY created_at DESC LIMIT 1;
```

## ๐ฏ ะะฐะบะปััะตะฝะธะต

ะะฐัะฐ ะฐััะธัะตะบัััะฐ **ัะถะต ะพะฟัะธะผะฐะปัะฝะฐ**! ะฏ ัะพะปัะบะพ ัะปัััะธะป ัััะตััะฒัััะธะน ะบะพะด ะดะปั:
- ะะพะปะตะต ะฝะฐะดะตะถะฝะพะณะพ ัะพะทะดะฐะฝะธั ะฟัะพัะธะปะตะน
- ะัััะตะน ะพะฑัะฐะฑะพัะบะธ ะพัะธะฑะพะบ
- ะะฒัะพะผะฐัะธัะตัะบะพะน ะทะฐะณััะทะบะธ ะฟัะพัะธะปะตะน

ะะธะบะฐะบะธั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ัะฐะฑะปะธั ัะพะทะดะฐะฒะฐัั **ะะ ะะฃะะะ** - ัะตะบััะตะต ัะตัะตะฝะธะต ัะฒะปัะตััั ะธะฝะดััััะธะฐะปัะฝัะผ ััะฐะฝะดะฐััะพะผ ะดะปั ะฟัะธะปะพะถะตะฝะธะน ะฝะฐ Supabase.